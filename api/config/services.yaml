services:
    _defaults:
        public: false
        autowire: true
        autoconfigure: true
        bind:
            $commandBus: '@command.bus'
            $eventBus:   '@event.bus'

    App\:
        resource: '../src/**/*'
        exclude:
            - '../src/**/*/{*Controller.php,DependencyInjection,Model,Repository,Resources,Kernel.php}'
            - '../src/Core/*'
            - '../src/**/*/{Handler}'

    command_handlers:
        namespace: App\
        resource: '%kernel.project_dir%/src/**/*/{*Handler.php}'
        autoconfigure: false
        tags:
            - { name: messenger.message_handler, bus: command.bus }

    App\Core\Domain\Saga\VoucherProcessManager:
        tags:
            - { name: messenger.message_handler, bus: event.bus, handles: App\Core\Domain\Event\OrderForVoucherPlaced }
            - { name: messenger.message_handler, bus: event.bus, handles: App\Payment\Domain\Event\PaymentWasPaid }

    DateTimeImmutable:
        class: \DateTimeImmutable
        
    App\Voucher\Domain\Repository\VoucherRepositoryInterface:
        class: App\Voucher\Infrastructure\Repository\VoucherRepository
        
    App\User\Domain\Repository\UserRepositoryInterface:
        class: App\User\Infrastructure\Repository\UserRepository
        
    App\Payment\Domain\Repository\PaymentRepositoryInterface:
        class: App\Payment\Domain\Repository\PaymentRepository
        
    App\Order\Domain\Repository\OrderRepositoryInterface:
        class: App\Order\Domain\Repository\OrderRepository

